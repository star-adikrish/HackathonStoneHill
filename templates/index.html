<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #9f7aea;
            --primary-dark: #805ad5;
            --accent: #ed64a6;
            --surface: rgba(255, 255, 255, 0.9);
            --surface-elevated: #fff;
            --text: #2d3748;
            --text-muted: #718096;
            --border: rgba(147, 112, 219, 0.2);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 20px 40px rgba(147, 112, 219, 0.12);
            --gradient: linear-gradient(135deg, #9f7aea 0%, #ed64a6 100%);
            --whatsapp: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
        }

        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 16px;
            background: linear-gradient(135deg, #e8f4f8 0%, #fdf2f8 35%, #fef9e7 70%, #f0f9ff 100%);
            -webkit-font-smoothing: antialiased;
        }

        @media (min-width: 768px) {
            body {
                padding: 24px;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 28px;
            box-shadow: var(--shadow), var(--shadow-lg);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.9);
            animation: containerEntrance 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes containerEntrance {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: var(--gradient);
            color: white;
            padding: 28px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            pointer-events: none;
        }

        @media (min-width: 768px) {
            .header {
                padding: 40px 48px;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
        }

        .header h1 {
            font-size: 1.85em;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
        }

        .user-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .user-info {
                justify-content: flex-end;
            }
        }

        .user-info span {
            font-weight: 500;
            opacity: 0.95;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 22px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 24px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.25s ease;
            backdrop-filter: blur(8px);
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .content {
            padding: 28px 24px;
        }

        @media (min-width: 768px) {
            .content {
                padding: 48px;
            }
        }

        .tabs {
            display: flex;
            flex-direction: column;
            margin-bottom: 32px;
            background: rgba(248, 249, 255, 0.8);
            border-radius: 16px;
            padding: 6px;
            gap: 6px;
        }

        @media (min-width: 768px) {
            .tabs {
                flex-direction: row;
                gap: 0;
            }
        }

        .tab {
            padding: 14px 20px;
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
            text-align: center;
            font-family: inherit;
        }

        @media (min-width: 768px) {
            .tab {
                padding: 16px 28px;
                font-size: 15px;
                flex: 1;
            }
        }

        .tab.active {
            color: white;
            background: var(--gradient);
            box-shadow: 0 6px 20px rgba(159, 122, 234, 0.4);
        }

        .tab:hover:not(.active) {
            color: var(--primary);
            background: rgba(159, 122, 234, 0.12);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: tabFadeIn 0.4s ease-out;
        }

        @keyframes tabFadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            background: var(--surface-elevated);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 28px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s ease;
        }

        .form-section:hover {
            box-shadow: 0 8px 24px rgba(147, 112, 219, 0.1);
        }

        @media (min-width: 768px) {
            .form-section {
                padding: 40px;
                margin-bottom: 40px;
            }
        }

        .form-section h2 {
            color: var(--text);
            margin-bottom: 22px;
            font-weight: 700;
            font-size: 1.4em;
        }

        @media (min-width: 768px) {
            .form-section h2 {
                margin-bottom: 28px;
                font-size: 1.65em;
            }
        }

        .expense-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            align-items: end;
        }

        @media (min-width: 480px) {
            .expense-form {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .expense-form {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        input,
        select,
        textarea {
            padding: 16px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            font-family: inherit;
            transition: border-color 0.25s ease, box-shadow 0.25s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(159, 122, 234, 0.12);
        }

        .submit-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s ease, box-shadow 0.25s ease;
            box-shadow: 0 8px 24px rgba(159, 122, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(159, 122, 234, 0.4);
        }

        .expenses-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 768px) {
            .expenses-grid {
                grid-template-columns: minmax(320px, 400px) 1fr;
            }
        }

        .expense-card {
            background: var(--surface-elevated);
            padding: 18px 20px;
            border-radius: 14px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .expense-card strong {
            color: var(--text);
        }

        .expense-card small {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .expense-total {
            background: var(--gradient);
            color: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            margin-top: 24px;
            font-size: 1.25em;
            font-weight: 700;
        }

        .expense-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 48px 24px;
            font-size: 1.05rem;
        }

        .chart-wrap {
            max-width: 400px;
            margin: 0 auto;
        }

        .travel-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 28px;
        }

        @media (min-width: 900px) {
            .travel-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .travel-grid .form-section input {
            width: 100%;
            margin-bottom: 14px;
        }

        .contact-form {
            background: var(--surface-elevated);
            padding: 28px;
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        @media (min-width: 768px) {
            .contact-form {
                padding: 40px;
            }
        }

        .contact-form h2 {
            color: var(--text);
            margin-bottom: 22px;
            font-weight: 700;
            font-size: 1.4em;
        }

        .contact-form input,
        .contact-form textarea {
            width: 100%;
            padding: 16px 18px;
            margin-bottom: 14px;
        }

        .contact-form textarea {
            resize: vertical;
            min-height: 120px;
        }

        .whatsapp-btn {
            display: inline-block;
            background: var(--whatsapp);
            color: white;
            padding: 16px 32px;
            border-radius: 14px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.25s ease;
            box-shadow: 0 8px 24px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(37, 211, 102, 0.4);
        }

        .rating-section {
            margin-top: 28px;
        }

        .rating-section select {
            width: 100%;
            margin-bottom: 14px;
        }

        .rating-cta {
            margin-top: 28px;
            text-align: center;
        }

        /* Travel specific styles */
        .travel-input-card {
            background: #fff;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            font-size: 1.2rem;
            z-index: 10;
        }

        .input-wrapper input {
            padding-left: 50px;
            width: 100%;
        }

        .row-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .error-msg {
            color: #c53030;
            background: #fff5f5;
            border: 1px solid #feb2b2;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ticket-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        .ticket-header {
            background: var(--gradient);
            padding: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ticket-route {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .ticket-body {
            padding: 20px;
        }

        .ticket-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .cost-row:last-child {
            border-bottom: none;
        }

        .total-cost {
            background: #f0fff4;
            color: #276749;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-top: 10px;
            border: 1px solid #c6f6d5;
        }

        .secondary-btn {
            background: #fff;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .secondary-btn:hover {
            background: #f3efff;
        }

        /* Spinner */
        .btn-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Enhanced Tables */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }

        th,
        td {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            text-align: left;
        }

        th {
            background: #f8fafc;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: #fafafa;
        }

        /* Enhanced Lists (To-Do) */
        ul {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        li {
            background: white;
            padding: 16px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        li:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-color: var(--border);
        }

        li button {
            background: #fed7d7;
            color: #c53030;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        li button:hover {
            background: #feb2b2;
        }

        /* Team Section Improvements */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .team-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .team-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(159, 122, 234, 0.15);
        }

        .team-avatar {
            font-size: 4rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #f3efff 0%, #e6ffFA 100%);
            width: 100px;
            height: 100px;
            line-height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
        }

        .team-card h4 {
            font-size: 1.25rem;
            color: var(--text);
            margin-bottom: 5px;
        }

        .team-role {
            color: var(--primary);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .team-card p {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Form Inputs Enhancement */
        input[type="date"] {
            color: var(--text-muted);
        }

        /* Button Enhancements */
        .delete-btn {
            background-color: #fff5f5;
            color: #cc0000;
            border: 1px solid #fc8181;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background-color: #cc0000;
            color: white;
        }

        /* --- BLOG SECTION ENHANCEMENTS --- */
        .blog-hero {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(159, 122, 234, 0.1) 0%, rgba(237, 100, 166, 0.1) 100%);
            border-radius: 24px;
        }

        .blog-hero h1 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            padding-bottom: 40px;
        }

        .blog-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(0, 0, 0, 0.04);
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .blog-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(159, 122, 234, 0.25);
            border-color: rgba(159, 122, 234, 0.3);
        }

        /* Featured Post Styling */
        .blog-card.featured {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 40px;
            background: linear-gradient(135deg, #fff 0%, #f8faff 100%);
            border: 2px solid rgba(159, 122, 234, 0.1);
        }

        .blog-card.featured .blog-image {
            height: 100%;
            font-size: 6rem;
            background: linear-gradient(135deg, #e0e7ff 0%, #eef2ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            margin-bottom: 0;
        }

        .blog-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #9f7aea 0%, #ed64a6 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 12px rgba(237, 100, 166, 0.3);
        }

        .blog-image {
            height: 180px;
            background: #f7fafc;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 24px;
            transition: transform 0.4s ease;
        }

        .blog-card:hover .blog-image {
            transform: scale(1.05);
        }

        .blog-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .blog-date {
            color: var(--text-muted);
        }

        .blog-category {
            color: var(--primary);
            background: rgba(159, 122, 234, 0.1);
            padding: 2px 10px;
            border-radius: 6px;
        }

        .blog-card h3 {
            font-size: 1.4rem;
            color: var(--text);
            margin-bottom: 12px;
            line-height: 1.3;
            font-weight: 700;
        }

        .blog-card p {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 24px;
            flex-grow: 1;
            font-size: 0.95rem;
        }

        .read-more {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: gap 0.2s ease;
        }

        .read-more:hover {
            gap: 10px;
            color: var(--primary-dark);
        }

        @media (max-width: 768px) {
            .blog-card.featured {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .blog-card.featured .blog-image {
                height: 200px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Family Expense Tracker</h1>
            <div class="user-info">
                <span>Welcome, {{ user }}!</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" data-tab="scanner">üéüÔ∏è RECEIPT</button>
                <button class="tab " data-tab="expenses">üí∞ EXPENSES</button>
                <button class="tab" data-tab="travel">‚úàÔ∏è TRAVEL</button>
                <button class="tab" data-tab="contact">üìß CONTACT</button>
                <button class="tab" data-tab="meal">üçî MEAL PLANNER</button>
                <button class="tab" data-tab="todo">üìù TO DO LIST</button>
                <button class="tab" data-tab="about">üïµÔ∏è ABOUT US</button>
                <button class="tab" data-tab="blog">‚úçÔ∏è BLOG</button>
            </div>
            <div id="scanner" class="tab-content active">
                <h2>Scan Receipt</h2>

                <input type="file" id="imageInput" accept="image/*"><br><br>
                <button onclick="scanReceipt()">Scan Receipt</button><br><br>

                <h3>OCR Text</h3>
                <pre id="ocrOutput"></pre><br><br>

                <h3>Extracted Products</h3>
                <table id="productsTable">
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Paid By</th>
                        <th>Action</th>
                    </tr>
                </table><br><br>
            </div>

            <div id="expenses" class="tab-content">
                <div class="form-section">
                    <h2>‚ûï Add New Expense</h2>
                    <form method="POST" action="{{ url_for('add_expense') }}" class="expense-form">
                        <input type="date" name="date" required>
                        <input type="text" name="item" placeholder="What did you buy?" required>
                        <input type="number" name="amount" step="0.01" placeholder="Amount (‚Çπ)" max="10000000" required>
                        <select name="paid_by" required>
                            <option value="">Who paid?</option>
                            {% for member in family_members %}
                            <option value="{{ member }}">{{ member }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="submit-btn">Add Expense</button>
                    </form>
                </div>

                <div class="form-section">
                    <h2>üìä This Month's Expenses</h2>
                    {% if expenses %}
                    <div class="expenses-grid">
                        <div class="chart-wrap">
                            <canvas id="expenseChart" width="400" height="400"></canvas>
                        </div>
                        <div>
                            {% for expense in expenses %}
                            <div class="expense-card">
                                <strong>{{ expense.item }}</strong> - ‚Çπ{{ "%.2f"|format(expense.amount) }}<br>
                                <small>{{ expense.date }} | Paid by: {{ expense.paid_by }}</small>
                            </div>
                            {% endfor %}
                            <div class="expense-total">Total: ‚Çπ{{ "%.2f"|format(expenses|sum(attribute='amount')) }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <p class="expense-empty">No expenses recorded this month. Add your first expense above! üí∞</p>
                    {% endif %}
                </div>
            </div>

            <div id="travel" class="tab-content">
                <div class="travel-grid">
                    <div class="form-section travel-input-card">
                        <h2>‚úàÔ∏è Plan Your Trip</h2>
                        <div class="input-group">
                            <label class="input-label">From</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üõ´</span>
                                <input id="fromCity" placeholder="Origin (e.g., Delhi)" type="text">
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">To</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üõ¨</span>
                                <input id="toCity" placeholder="Destination (e.g., London)" type="text">
                            </div>
                        </div>

                        <div class="row-inputs">
                            <div class="input-group">
                                <label class="input-label">Travelers</label>
                                <div class="input-wrapper">
                                    <span class="input-icon">üë•</span>
                                    <input id="people" type="number" min="1" value="2">
                                </div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Duration</label>
                                <div class="input-wrapper">
                                    <span class="input-icon">üìÖ</span>
                                    <input id="days" type="number" min="1" value="5">
                                </div>
                            </div>
                        </div>

                        <button class="submit-btn" onclick="planTravel()" id="planTravelBtn">
                            <span class="btn-text">Check Costs</span>
                            <span class="btn-loader" style="display:none;"></span>
                        </button>
                        <div id="travelError" class="error-msg" style="display:none;"></div>
                        <div id="travelResult"></div>
                    </div>

                    <div class="form-section">
                        <h2>üå§Ô∏è Weather & AQI</h2>
                        <div class="input-group">
                            <label class="input-label">Check City Weather</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üèôÔ∏è</span>
                                <input id="cityInputTravel" placeholder="Enter city name..." type="text">
                            </div>
                        </div>
                        <div class="checkbox-group" style="margin: 12px 0;">
                            <input type="checkbox" id="aqiCheckTravel" checked>
                            <label for="aqiCheckTravel">Include Air Quality Report</label>
                        </div>
                        <button class="submit-btn secondary-btn" onclick="getWeatherTravel()">Get Report</button>

                        <div id="weatherErrorTravel" class="error-msg" style="display: none; margin-top: 14px;"></div>
                        <div id="aqiResultTravel" style="margin-top: 20px;"></div>

                        <div class="search-history" id="searchHistoryTravel" style="margin-top: 24px; display: none;">
                            <h3>Recent Checks</h3>
                            <div id="historyTableBodyTravel" class="history-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="contact" class="tab-content">
                <div class="contact-form">
                    <h2>Send Message</h2>
                    <form method="POST" action="{{ url_for('contact') }}">
                        <input type="text" name="name" placeholder="Your Name" required>
                        <input type="email" name="email" placeholder="Your Email" required>
                        <input type="text" name="subject" placeholder="Subject" required>
                        <textarea name="message" placeholder="Your Message" rows="5" required></textarea>
                        <button type="button" class="whatsapp-btn" onclick="sendToWhatsApp()">üí¨ Send via
                            WhatsApp</button>
                    </form>
                </div>
                <div class="contact-form rating-section">
                    <h2>‚≠ê Rate Your Experience</h2>
                    <select id="stars">
                        <option value="">Select Rating</option>
                        <option>‚≠ê</option>
                        <option>‚≠ê‚≠ê</option>
                        <option>‚≠ê‚≠ê‚≠ê</option>
                        <option>‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        <option>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    </select>
                    <button class="submit-btn" onclick="submitFeedback()">Submit</button>
                    <p id="feedbackMsg" style="margin-top: 16px;"></p>
                    <div class="rating-cta">
                        <a href="https://wa.me/8618079219" class="whatsapp-btn">üí¨ Message us on WhatsApp</a>
                    </div>
                </div>
            </div>
        </div>
        <div id="meal" class="tab-content">
            <div class="form-section">
                <h2>üç≤ Meal Planner</h2>
                <form id="mealForm">
                    <label for="date">Date:</label>
                    <input type="date" id="Date" name="Date" required>
                    <label for="Breakfast">Breakfast:</label>
                    <input type="text" id="Breakfast" name="Breakfast" required>
                    <label for="Lunch">Lunch:</label>
                    <input type="text" id="Lunch" name="Lunch" required>
                    <label for="Dinner">Dinner:</label>
                    <input type="text" id="Dinner" name="Dinner" required>
                    <label for="Snack">Snack:</label>
                    <input type="text" id="Snack" name="Snack" required>
                    <button type="submit">Add Meal</button>
                </form>
                <table id="mealTable" class="bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Breakfast</th>
                            <th>Lunch</th>
                            <th>Dinner</th>
                            <th>Snack</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table><br><br>
            </div>
        </div>
        <div id="todo" class="tab-content">
            <div class="form-section">
                <h2>To-Do List</h2>

                <input id="todoInput" placeholder="Add a task..." />
                <button onclick="addTodo()">Add</button>

                <ul id="todoList"></ul>
            </div>


        </div>
        <div id="about" class="tab-content">
            <div class="form-section">
                <h2>‚ÑπÔ∏è About Us</h2>

                <div class="about-content">
                    <p>
                        Welcome to <strong>FamEase</strong> üëã!
                        This app helps you easily track daily expenses, manage spending,
                        and stay on top of your finances without the headache.
                    </p>

                    <p>
                        Built with basic code from scratch, our goal is to keep money tracking fast,
                        clean, and stress-free.
                    </p>

                    <p>
                        Whether you're splitting bills, going on vacation, tracking personal expenses,
                        or just trying to save more, we've got your back. üí™
                    </p>
                    <br>
                    <p>
                        The app exists to help families manage their finances with ease, providing tools for
                        budgeting, saving, and tracking expenses in one place.
                        It aims to reduce financial stress by offering a simple way for families to organize their
                        spending and achieve their financial goals - whether
                        it's saving for a vacation or building an emergency fund. <br>
                        Additionally, the app encourages family collaboration, making it easy for everyone to
                        participate in managing finances, even kids.
                        By providing clear insights into spending patterns and setting financial goals, the app
                        empowers
                        families to make smarter financial decisions, save for the future, and plan memorable,
                        budget-friendly vacations.
                        Ultimately, its goal is to help families feel more in control of their money and more
                        confident about their financial health.<br>

                    </p>
                    <div class="mission-section">
                        <h2>Our Mission</h2>
                        <p>Our mission is to simplify family life by providing an all-in-one app that helps users
                            manage their budgets, plan memorable vacations, organize meals, and stay on top of
                            everyday tasks‚Äîempowering families to spend smarter, travel more, and enjoy every moment
                            together.</p>
                    </div>

                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">üí∞</div>
                            <h3>Expense Tracker</h3>
                            <p>Track income, expenses, and visualize spending trends with customizable categories
                            </p>
                        </div>

                        <div class="feature-card">
                            <div class="feature-icon">üß≥</div>
                            <h3>Vacation Travel Budgeting</h3>
                            <p>Estimate and track vacation costs real-time</p>
                        </div>

                        <div class="feature-card">
                            <div class="feature-icon">üçΩÔ∏è</div>
                            <h3>Meal Planner</h3>
                            <p>Plan weekly meals based on a balanced diet, ensuring nutritional variety and healthy
                                eating</p>
                        </div>

                        <div class="feature-card">
                            <div class="feature-icon">‚úçÔ∏è</div>
                            <h3>Visionary Blogs</h3>
                            <p>Inspire and inform users with forward-thinking content on budgeting, travel,
                                wellness, and lifestyle, helping families stay ahead of trends</p>
                        </div>
                    </div>

                    <div class="team-section">
                        <h2>Meet Our Team</h2>
                        <div class="final-section">
                            <p><b>Our team has worked hard with a strong sense of collaboration, combining diverse
                                    skills and
                                    expertise to build an intuitive and reliable app
                                    that simplifies family budgeting and financial management.</b><br></p>
                        </div>
                        <div class="team-grid">
                            <!-- Team Member 1 -->
                            <div class="team-card">
                                <div class="team-avatar">üë®‚Äçüíª</div>
                                <h4>Krishna Agarwal</h4>
                                <p class="team-role">Tech Lead & Backend Developer</p>
                                <p>Experienced tech expert with 4+ hackathons under his belt, consistently leading the
                                    team to success with robust backend solutions.</p>
                            </div>

                            <!-- Team Member 2 -->
                            <div class="team-card">
                                <div class="team-avatar">üë®‚Äçüíª</div>
                                <h4>S Shravan</h4>
                                <p class="team-role">Frontend Specialist</p>
                                <p>Logical and technical coder focused on crafting user-friendly interfaces and seamless
                                    interactive experiences.</p>
                            </div>

                            <!-- Team Member 3 -->
                            <div class="team-card">
                                <div class="team-avatar">üë©‚Äçüî¨</div>
                                <h4>Aishani Satheesh Rai</h4>
                                <p class="team-role">UX/UI Designer & Tester</p>
                                <p>Enthusiastic coder driven by curiosity, ensuring the application is meaningful,
                                    bug-free, and intuitive.</p>
                            </div>

                            <!-- Team Member 4 -->
                            <div class="team-card">
                                <div class="team-avatar">üë®‚Äçüé®</div>
                                <h4>Jake Manu</h4>
                                <p class="team-role">Creative Developer</p>
                                <p>Innovative developer exploring design solutions to build simple, useful, and
                                    impactful applications.</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div id="blog" class="tab-content">
            <div class="form-section">
                <div class="blog-hero">
                    <h1>Family Budget, Meal-planning and Savings Blog</h1>
                    <p class="hero-subtitle">Latest insights on daily meals, expenses and savings</p>
                    <div class="blog-content">
                        <div class="blog-grid">
                            <article class="blog-card featured" style="cursor: pointer;">
                                <div class="blog-badge">FEATURED</div>
                                <div class="blog-image">üíª</div>
                                <div class="blog-meta">
                                    <span class="blog-date">Feb 12th, 2026</span>
                                    <span class="blog-category">Tech</span>
                                </div>
                                <h3>Stonehill International Techno-fest</h3>
                                <p></p>
                                <a href="Blogs/blog5.html" class="read-more">Read
                                    More ‚Üí</a>
                            </article>

                            <article class="blog-card" style="cursor: pointer;">
                                <div class="blog-image">üçï</div>
                                <div class="blog-meta">
                                    <span class="blog-date">Feb 12th, 2026</span>
                                    <span class="blog-category">Meal Planning</span>
                                </div>
                                <h3>Balance in food</h3>
                                <p>How Meal Planning Can Help Your Family Eat Healthier and Save Money...</p>
                                <a href="Blogs/blog1.html" class="read-more">Read
                                    More ‚Üí</a>
                            </article>

                            <article class="blog-card" style="cursor: pointer;">
                                <div class="blog-image">üí∞</div>
                                <div class="blog-meta">
                                    <span class="blog-date">Feb 10th, 2026</span>
                                    <span class="blog-category">Savings</span>
                                </div>
                                <h3>Smart Savings Strategies for Families</h3>
                                <p>How to Build a Secure Future Together...</p>
                                <a href="Blogs/blog2.html" class="read-more">Read
                                    More ‚Üí</a>
                            </article>

                            <article class="blog-card" style="cursor: pointer;">
                                <div class="blog-image">üíµ</div>
                                <div class="blog-meta">
                                    <span class="blog-date">Jan 30th, 2026</span>
                                    <span class="blog-category">Budgeting</span>
                                </div>
                                <h3>The Ultimate Guide to Family Budgeting</h3>
                                <p>Innovative approaches to Save More, Spend Smarter...</p>
                                <a href="Blogs/blog3.html" class="read-more">Read
                                    More ‚Üí</a>
                            </article>

                            <article class="blog-card" style="cursor: pointer;">
                                <div class="blog-image">üå±</div>
                                <div class="blog-meta">
                                    <span class="blog-date">Jan 8th, 2026</span>
                                    <span class="blog-category">Sustainability</span>
                                </div>
                                <h3>Sustainable Living on a Budget</h3>
                                <p>How Reusing and Recycling Can Save You Money...</p>
                                <a href="Blogs/blog4.html" class="read-more">Read
                                    More ‚Üí</a>
                            </article>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Load live data on page load
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelectorAll('.tab').forEach(function (tab) {
                    tab.addEventListener('click', function () {
                        const tabName = this.getAttribute('data-tab');
                        showTab(tabName);
                    });
                });

                // Initialize chart if expenses exist
                {% if expenses %}
                initChart();
                {% endif %}

                // Load live global data (if elements exist)
                if (document.getElementById('liveTemp')) loadLiveData();

                document.getElementById('cityInputTravel').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') getWeatherTravel();
                });
            });

            let searchHistoryTravel = [];

            async function getWeatherTravel() {
                const city = document.getElementById('cityInputTravel').value.trim();
                const includeAqi = document.getElementById('aqiCheckTravel').checked;

                if (!city) {
                    document.getElementById('weatherErrorTravel').textContent = 'Please enter a city name';
                    document.getElementById('weatherErrorTravel').style.display = 'block';
                    document.getElementById('aqiResultTravel').innerHTML = '';
                    return;
                }

                try {
                    document.getElementById('weatherErrorTravel').style.display = 'none';
                    document.getElementById('aqiResultTravel').innerHTML = '<div style="padding: 15px; background: rgba(159, 122, 234, 0.1); border-radius: 10px;">Checking weather & air quality...</div>';

                    const API_KEY = 'e84a8261d3cd4786a8281927250707';
                    const WEATHER_URL = 'https://api.weatherapi.com/v1';
                    const aqiParam = includeAqi ? 'yes' : 'no';
                    const url = `${WEATHER_URL}/current.json?key=${API_KEY}&q=${encodeURIComponent(city)}&aqi=${aqiParam}`;

                    const response = await fetch(url);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error?.message || 'Failed to fetch weather data');
                    }

                    displayWeatherTravel(data, includeAqi);
                } catch (error) {
                    document.getElementById('weatherErrorTravel').textContent = error.message;
                    document.getElementById('weatherErrorTravel').style.display = 'block';
                    document.getElementById('aqiResultTravel').innerHTML = '';
                }
            }

            function displayWeatherTravel(data, showAqi) {
                const { location, current } = data;

                let html = `
                    <div style="background: rgba(159, 122, 234, 0.08); border: 1px solid var(--border); padding: 24px; border-radius: 16px; margin-top: 16px;">
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: var(--text); font-size: 1.3em; margin-bottom: 4px;">${location.name}</h3>
                            <p style="color: var(--text-muted); font-size: 0.95rem;">${location.region ? location.region + ', ' : ''}${location.country}</p>
                            <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 8px;">Last updated: ${current.last_updated}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                            <div style="background: var(--surface-elevated); padding: 20px; border-radius: 12px; border: 1px solid var(--border);">
                                <h4 style="color: var(--text); margin-bottom: 12px;">Current Weather</h4>
                                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                                    <img src="https:${current.condition.icon}" alt="${current.condition.text}" style="width: 64px; height: 64px;">
                                    <div>
                                        <div style="font-size: 2em; font-weight: bold; color: #9f7aea;">${current.temp_c}¬∞C</div>
                                        <div style="color: var(--text-muted);">${current.condition.text}</div>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.9rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>Feels like</span><span>${current.feelslike_c}¬∞C</span></div>
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>Humidity</span><span>${current.humidity}%</span></div>
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>Wind</span><span>${current.wind_kph} km/h ${current.wind_dir || ''}</span></div>
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>Pressure</span><span>${current.pressure_mb} mb</span></div>
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>Visibility</span><span>${current.vis_km} km</span></div>
                                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);"><span>UV Index</span><span>${current.uv}</span></div>
                                </div>
                            </div>`;

                if (showAqi && current.air_quality) {
                    const epaIndex = current.air_quality['us-epa-index'];
                    let statusText, bgColor, textColor;
                    if (epaIndex === 1) { statusText = 'Good - Air quality is satisfactory'; bgColor = '#d4edda'; textColor = '#155724'; }
                    else if (epaIndex === 2) { statusText = 'Moderate - Acceptable for most people'; bgColor = '#fff3cd'; textColor = '#000'; }
                    else if (epaIndex === 3) { statusText = 'Unhealthy for Sensitive Groups'; bgColor = '#ffe5cc'; textColor = '#cc5200'; }
                    else if (epaIndex === 4) { statusText = 'Unhealthy - Everyone may experience effects'; bgColor = '#ffcccc'; textColor = '#cc0000'; }
                    else if (epaIndex === 5) { statusText = 'Very Unhealthy - Health alert'; bgColor = '#e6ccff'; textColor = '#660099'; }
                    else { statusText = 'Hazardous - Health warning'; bgColor = '#cc99cc'; textColor = '#4d0066'; }

                    html += `
                            <div style="background: var(--surface-elevated); padding: 20px; border-radius: 12px; border: 1px solid var(--border);">
                                <h4 style="color: var(--text); margin-bottom: 12px;">Air Quality Index</h4>
                                <div style="background: ${bgColor}; color: ${textColor}; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-weight: 600; text-align: center;">${statusText}<br><strong style="font-size: 1.3em; margin-top: 8px; display: inline-block;">AQI Level: ${epaIndex}</strong></div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>CO</strong><br>${current.air_quality.co}</div>
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>NO2</strong><br>${current.air_quality.no2}</div>
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>O3</strong><br>${current.air_quality.o3}</div>
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>SO2</strong><br>${current.air_quality.so2}</div>
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>PM2.5</strong><br>${current.air_quality.pm2_5}</div>
                                    <div style="padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;"><strong>PM10</strong><br>${current.air_quality.pm10}</div>
                                </div>
                            </div>`;
                }

                html += '</div></div>';
                document.getElementById('aqiResultTravel').innerHTML = html;

                const historyItem = { city: `${location.name}, ${location.country}`, temperature: `${current.temp_c}¬∞C`, condition: current.condition.text, time: new Date().toLocaleTimeString() };
                searchHistoryTravel.unshift(historyItem);
                if (searchHistoryTravel.length > 2) searchHistoryTravel = searchHistoryTravel.slice(0, 2);
                updateHistoryTableTravel();
            }

            function updateHistoryTableTravel() {
                const tbody = document.getElementById('historyTableBodyTravel');
                tbody.innerHTML = '';
                searchHistoryTravel.forEach(item => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = item.city;
                    row.insertCell(1).textContent = item.temperature;
                    row.insertCell(2).textContent = item.condition;
                    row.insertCell(3).textContent = item.time;
                });
                document.getElementById('searchHistoryTravel').style.display = searchHistoryTravel.length > 0 ? 'block' : 'none';
            }

            function loadLiveData() {
                const cities = ['Delhi', 'Mumbai', 'London', 'New York', 'Tokyo'];
                const randomCity = cities[Math.floor(Math.random() * cities.length)];

                const API_KEY = 'e84a8261d3cd4786a8281927250707';
                const WEATHER_URL = 'https://api.weatherapi.com/v1';

                fetch(`${WEATHER_URL}/current.json?key=${API_KEY}&q=${randomCity}&aqi=yes`)
                    .then(response => response.json())
                    .then(data => {
                        const { location, current } = data;

                        document.getElementById('liveTemp').innerHTML = `
                            <div style="font-size: 24px;">üå°Ô∏è</div>
                            <div style="font-size: 18px; font-weight: 600; color: #9f7aea;">${current.temp_c}¬∞C</div>
                            <div style="font-size: 12px; color: #666;">${location.name}</div>
                        `;

                        const epaIndex = current.air_quality['us-epa-index'];
                        let aqiColor = '#9f7aea';
                        if (epaIndex <= 2) aqiColor = '#00e400';
                        else if (epaIndex <= 3) aqiColor = '#ffff00';
                        else if (epaIndex <= 4) aqiColor = '#ff7e00';
                        else aqiColor = '#ff0000';

                        document.getElementById('liveAQI').innerHTML = `
                            <div style="font-size: 24px;">üå¨Ô∏è</div>
                            <div style="font-size: 18px; font-weight: 600; color: ${aqiColor};">AQI ${epaIndex}</div>
                            <div style="font-size: 12px; color: #666;">${location.name}</div>
                        `;
                    })
                    .catch(() => {
                        document.getElementById('liveTemp').innerHTML = `
                            <div style="font-size: 24px;">üå°Ô∏è</div>
                            <div style="font-size: 18px; font-weight: 600; color: #9f7aea;">--¬∞C</div>
                            <div style="font-size: 12px; color: #666;">Offline</div>
                        `;
                        document.getElementById('liveAQI').innerHTML = `
                            <div style="font-size: 24px;">üå¨Ô∏è</div>
                            <div style="font-size: 18px; font-weight: 600; color: #9f7aea;">--</div>
                            <div style="font-size: 12px; color: #666;">Offline</div>
                        `;
                    });
            }

            function showTab(tabName) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(tabName).classList.add('active');
            }

            function initChart() {
                const expenses = {{ expenses| tojson
            }};
            const memberTotals = {};

            expenses.forEach(expense => {
                if (!memberTotals[expense.paid_by]) {
                    memberTotals[expense.paid_by] = 0;
                }
                memberTotals[expense.paid_by] += expense.amount;
            });

            const ctx = document.getElementById('expenseChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(memberTotals),
                    datasets: [{
                        data: Object.values(memberTotals),
                        backgroundColor: ['#9f7aea', '#ed64a6', '#f093fb', '#4ecdc4', '#ffb347']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            }

            function checkAQI() {
                const city = document.getElementById('cityInput').value;
                if (!city) {
                    document.getElementById('aqiResult').innerHTML = '<div style="color: red; padding: 15px; background: rgba(255,0,0,0.1); border-radius: 10px;">Please enter a city name!</div>';
                    return;
                }

                document.getElementById('aqiResult').innerHTML = '<div style="padding: 15px; background: rgba(159, 122, 234, 0.1); border-radius: 10px;">üîç Checking weather & air quality...</div>';

                // Use real API call
                const API_KEY = 'e84a8261d3cd4786a8281927250707';
                const WEATHER_URL = 'https://api.weatherapi.com/v1';

                fetch(`${WEATHER_URL}/current.json?key=${API_KEY}&q=${encodeURIComponent(city)}&aqi=yes`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            throw new Error(data.error.message);
                        }

                        const { location, current } = data;
                        const epaIndex = current.air_quality['us-epa-index'];
                        const aqiValue = Math.round(current.air_quality.pm2_5 * 2.5); // Convert PM2.5 to AQI approximation
                        let statusText, color, advice;

                        if (epaIndex === 1) {
                            statusText = 'Good';
                            color = '#00e400';
                            advice = 'Air quality is satisfactory and poses little or no risk.';
                        } else if (epaIndex === 2) {
                            statusText = 'Moderate';
                            color = '#ffff00';
                            advice = 'Air quality is acceptable for most people.';
                        } else if (epaIndex === 3) {
                            statusText = 'Unhealthy for Sensitive Groups';
                            color = '#ff7e00';
                            advice = 'Sensitive individuals should limit outdoor activities.';
                        } else if (epaIndex === 4) {
                            statusText = 'Unhealthy';
                            color = '#ff0000';
                            advice = 'Everyone should limit outdoor activities.';
                        } else if (epaIndex === 5) {
                            statusText = 'Very Unhealthy';
                            color = '#8f3f97';
                            advice = 'Health alert: everyone may experience serious health effects.';
                        } else {
                            statusText = 'Hazardous';
                            color = '#7e0023';
                            advice = 'Emergency conditions. Stay indoors with air purifier.';
                        }
                        const textColor = (color === '#ffff00') ? '#000' : color;

                        document.getElementById('aqiResult').innerHTML = `
                            <div style="background: ${color}20; border: 2px solid ${color}; padding: 20px; border-radius: 15px; margin-top: 15px;">
                                <h3 style="color: ${textColor}; margin-bottom: 15px;">${location.name}, ${location.country}</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5em; font-weight: bold; color: #9f7aea;">${current.temp_c}¬∞C</div>
                                        <div style="font-weight: bold; color: #9f7aea;">Temperature</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Feels like ${current.feelslike_c}¬∞C</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5em; font-weight: bold; color: ${textColor};">${aqiValue}</div>
                                        <div style="font-weight: bold; color: ${textColor};">AQI ${statusText}</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">EPA Level: ${epaIndex}</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #333;">PM2.5</div>
                                        <div style="font-size: 2em; font-weight: bold; color: ${textColor};">${current.air_quality.pm2_5}</div>
                                        <div style="font-size: 12px; color: #666;">particles</div>
                                    </div>
                                </div>
                                <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                    <h4 style="margin-bottom: 10px; color: #333;">Other Pollutants</h4>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 12px;">
                                        <div><strong>Coarse Particles (PM10):</strong><br>${current.air_quality.pm10} particles</div>
                                        <div><strong>Carbon Monoxide (CO):</strong><br>${current.air_quality.co} units</div>
                                        <div><strong>Nitrogen Dioxide (NO2):</strong><br>${current.air_quality.no2} units</div>
                                        <div><strong>Ozone (O3):</strong><br>${current.air_quality.o3} units</div>
                                        <div><strong>Sulfur Dioxide (SO2):</strong><br>${current.air_quality.so2} units</div>
                                    </div>
                                </div>
                                <p style="color: #333; font-weight: 500; text-align: center;">${advice}</p>
                            </div>
                        `;
                    })
                    .catch(error => {
                        document.getElementById('aqiResult').innerHTML = `<div style="color: red; padding: 15px; background: rgba(255,0,0,0.1); border-radius: 10px;">Error: ${error.message}</div>`;
                    });
            }

            function sendToWhatsApp() {
                const name = document.querySelector('input[name="name"]').value;
                const email = document.querySelector('input[name="email"]').value;
                const subject = document.querySelector('input[name="subject"]').value;
                const message = document.querySelector('textarea[name="message"]').value;

                if (!name || !email || !subject || !message) {
                    alert('Please fill all fields before sending to WhatsApp!');
                    return;
                }

                const whatsappMessage = `Name: ${name}\nEmail: ${email}\nSubject: ${subject}\nMessage: ${message}`;
                const whatsappUrl = `https://wa.me/8618079219?text=${encodeURIComponent(whatsappMessage)}`;
                window.open(whatsappUrl, '_blank');
            }

            function submitFeedback() {
                const rating = document.getElementById('stars').value;
                if (!rating) {
                    document.getElementById('feedbackMsg').innerHTML = '<span style="color: red;">Please select a rating!</span>';
                    return;
                }
                document.getElementById('feedbackMsg').innerHTML = `<span style="color: #9f7aea;">Thank you for rating us ${rating}!</span>`;
                document.getElementById('stars').value = '';
            }

            function planTravel() {
                const fromCity = document.getElementById('fromCity').value.trim();
                const toCity = document.getElementById('toCity').value.trim();
                const people = parseInt(document.getElementById('people').value, 10) || 1;
                const days = parseInt(document.getElementById('days').value, 10) || 1;

                const errorDiv = document.getElementById('travelError');
                const resultDiv = document.getElementById('travelResult');
                const btn = document.getElementById('planTravelBtn');

                errorDiv.style.display = 'none';
                resultDiv.innerHTML = '';

                if (!toCity) {
                    errorDiv.innerHTML = '‚ö†Ô∏è Please enter a destination city.';
                    errorDiv.style.display = 'block';
                    return;
                }

                // Loading state
                btn.classList.add('loading');
                btn.querySelector('.btn-text').textContent = 'Researching...';
                btn.querySelector('.btn-loader').style.display = 'inline-block';

                fetch('/calculate_travel_cost', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination: toCity,
                        origin: fromCity,
                        days: Math.max(1, days),
                        people: Math.max(1, people)
                    })
                })
                    .then(response => response.json().then(data => ({ ok: response.ok, data })))
                    .then(({ ok, data }) => {
                        if (!ok) {
                            errorDiv.innerHTML = `‚ö†Ô∏è ${data.error || 'Could not verify place.'}`;
                            errorDiv.style.display = 'block';
                            return;
                        }

                        const aiTotal = data.total;
                        const perPerson = Math.round(aiTotal / people);

                        resultDiv.innerHTML = `
                        <div class="ticket-card">
                            <div class="ticket-header">
                                <div class="ticket-route">${fromCity || 'Anywhere'} ‚ûù ${toCity}</div>
                                <div>‚úàÔ∏è Ticket Estimate</div>
                            </div>
                            <div class="ticket-body">
                                <div class="ticket-details">
                                    <div><strong>üë• Travelers:</strong> ${people}</div>
                                    <div><strong>üóìÔ∏è Duration:</strong> ${days} days</div>
                                    <div><strong>üë§ Per Person:</strong> ‚Çπ${perPerson.toLocaleString()}</div>
                                </div>
                                <h4 style="color: var(--text-muted); margin-bottom: 12px; font-size: 0.9rem;">ESTIMATED BREAKDOWN</h4>
                                <div class="cost-row"><span>üè® Accommodation</span> <strong>‚Çπ${data.accommodation.toLocaleString()}</strong></div>
                                <div class="cost-row"><span>üçî Food & Dining</span> <strong>‚Çπ${data.food.toLocaleString()}</strong></div>
                                <div class="cost-row"><span>üöï Transport</span> <strong>‚Çπ${data.transport.toLocaleString()}</strong></div>
                                <div class="cost-row"><span>üéüÔ∏è Activities</span> <strong>‚Çπ${data.activities.toLocaleString()}</strong></div>
                                
                                <div class="total-cost">Total Budget: ‚Çπ${aiTotal.toLocaleString()}</div>
                            </div>
                        </div>
                    `;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        errorDiv.innerHTML = '‚ùå Network error. Please check your connection.';
                        errorDiv.style.display = 'block';
                    })
                    .finally(() => {
                        btn.classList.remove('loading');
                        btn.querySelector('.btn-text').textContent = 'Check Costs';
                        btn.querySelector('.btn-loader').style.display = 'none';
                    });
            }



            /* ---------- TO DO LIST ---------- */
            let todos = [];

            function loadTodos() {
                try {
                    todos = JSON.parse(localStorage.getItem("todos")) || [];
                } catch {
                    todos = [];
                }
                renderTodos();
            }

            function saveTodos() {
                localStorage.setItem("todos", JSON.stringify(todos));
            }

            function renderTodos() {
                const todoList = document.getElementById("todoList");
                if (!todoList) return;

                todoList.innerHTML = "";
                todos.forEach((todo, index) => {
                    const li = document.createElement("li");
                    li.innerHTML = `${todo} <button onclick="deleteTodo(${index})">‚ùå</button>`;
                    todoList.appendChild(li);
                });
            }

            function addTodo() {
                const input = document.getElementById("todoInput");
                const value = input.value.trim();
                if (!value) return;

                todos.push(value);
                saveTodos();
                renderTodos();
                input.value = "";
            }

            function deleteTodo(index) {
                todos.splice(index, 1);
                saveTodos();
                renderTodos();
            }

            /* ---------- MEAL PLANNER ---------- */
            const mealForm = document.getElementById('mealForm');
            const mealTable = document.getElementById('mealTable');
            let tableBody;

            if (mealTable) {
                tableBody = mealTable.getElementsByTagName('tbody')[0];
            }

            function addMeal(event) {
                event.preventDefault();

                const date = document.getElementById('Date').value;
                const breakfast = document.getElementById('Breakfast').value;
                const lunch = document.getElementById('Lunch').value;
                const dinner = document.getElementById('Dinner').value;
                const snack = document.getElementById('Snack').value;

                if (!isFood(breakfast) || !isFood(lunch) || !isFood(dinner) || !isFood(snack)) {
                    alert("Please enter valid food names (letters and spaces only).");
                    return;
                }

                saveToLocalStorage(date, breakfast, lunch, dinner, snack);
                renderMeals();

                document.getElementById('Date').value = '';
                document.getElementById('Breakfast').value = '';
                document.getElementById('Lunch').value = '';
                document.getElementById('Dinner').value = '';
                document.getElementById('Snack').value = '';
            }

            function saveToLocalStorage(date, breakfast, lunch, dinner, snack) {
                let meals = JSON.parse(localStorage.getItem('meals')) || [];
                meals.push({ date, breakfast, lunch, dinner, snack });
                localStorage.setItem('meals', JSON.stringify(meals));
            }

            function deleteMeal(index) {
                let meals = JSON.parse(localStorage.getItem('meals')) || [];
                meals.splice(index, 1);
                localStorage.setItem('meals', JSON.stringify(meals));
                renderMeals();
            }

            function isFood(input) {
                const foodRegex = /^[a-zA-Z\s]+$/;
                return foodRegex.test(input.trim());
            }

            function renderMeals() {
                if (!tableBody) return;
                tableBody.innerHTML = '';

                let meals = JSON.parse(localStorage.getItem('meals')) || [];

                meals.forEach((meal, index) => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${meal.date}</td>
                        <td>${meal.breakfast}</td>
                        <td>${meal.lunch}</td>
                        <td>${meal.dinner}</td>
                        <td>${meal.snack}</td>
                        <td><button class="delete-btn" onclick="deleteMeal(${index})">Delete</button></td>
                    `;
                    tableBody.appendChild(newRow);
                });
            }

            if (mealForm) {
                mealForm.addEventListener('submit', addMeal);
            }

            function updateHistoryTableTravel() {
                const container = document.getElementById('historyTableBodyTravel');
                container.innerHTML = '';
                searchHistoryTravel.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div>
                            <div style="font-weight:600;">${item.city}</div>
                            <div style="font-size:0.8rem; color:var(--text-muted);">${item.time}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:bold; color:var(--primary);">${item.temperature}</div>
                            <div style="font-size:0.8rem;">${item.condition}</div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                document.getElementById('searchHistoryTravel').style.display = searchHistoryTravel.length > 0 ? 'block' : 'none';
            }

            // Initialize Data
            loadTodos();
            renderMeals();
        </script>
    </div>
</body>

</html>